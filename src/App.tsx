import { useState, useRef, useEffect } from "react";
import Message from "./components/Message";
import { ChatMessage } from "./components/types";

export default function App() {
    const [message, setMessage] = useState("");
    const [messages, setMessages] = useState([] as Array<ChatMessage>);
    const messagesEndRef = useRef<HTMLDivElement>(null);

    const scrollToBottom = () => {
        if (messagesEndRef.current) {
            messagesEndRef.current.scrollIntoView({ behavior: "smooth" });
        }
    };

    useEffect(() => {
        scrollToBottom();
    }, [messages]);

    return (
        <div className="flex flex-row justify-center">
            <div className="justify-center flex flex-col">
                <div>
                    {messages.map((msg, index) => (
                        <Message
                            key={index}
                            name={msg.name}
                            message={msg.message}
                        />
                    ))}
                    <div ref={messagesEndRef} />
                </div>
                <div className="flex flex-row bottom-0 sticky justify-center">
                    <input
                        onChange={(e) => setMessage(e.target.value)}
                        className="m-8 p-4 rounded-xl"
                    />
                    <button
                        onClick={(_e) => {
                            setMessages((old) => [
                                ...old,
                                { name: "ok", message },
                            ]);
                        }}
                        className="p-4 bg-col4 m-8 ml-2 rounded-xl"
                    >
                        SEND
                    </button>
                </div>
            </div>
        </div>
    );
}
